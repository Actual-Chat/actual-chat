@namespace ActualChat.Chat.UI.Blazor.Components
@inherits MenuBase

@if (_chatMessageModel != null) {
    <CascadingValue Value="@_chatMessageModel">
        <MessageMenuContent ClickedLinkUrl="@_link" />
    </CascadingValue>
}

@code {
    private ChatMessageModel? _chatMessageModel;
    private string? _link;

    [Inject] private IChats Chats { get; init; } = null!;
    [Inject] private Session Session { get; init; } = null!;

    protected override async Task OnParametersSetAsync() {
        if (Arguments is { Length: 3 }) {
            var chatId = Arguments[0];
            var entryId = long.Parse(Arguments[1]);
            _link = Arguments[2].NullIfEmpty();
            var reader = Chats.NewEntryReader(Session, chatId, ChatEntryType.Text);
            var chatEntry = await reader.Get(entryId, CancellationToken.None);
            _chatMessageModel = chatEntry != null
                ? new ChatMessageModel(chatEntry)
                : null;
        }
    }
}
