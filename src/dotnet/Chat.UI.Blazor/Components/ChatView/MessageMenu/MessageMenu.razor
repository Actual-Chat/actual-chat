@namespace ActualChat.Chat.UI.Blazor.Components
@inherits MenuBase

@if (_chatMessageModel != null) {
    <MessageMenuContent
        ChatMessageModel="_chatMessageModel"
        ClickedLinkUrl="@_link">
    </MessageMenuContent>
}

@code {
    private ChatMessageModel? _chatMessageModel;
    private string? _link;

    [Inject] private IChats Chats { get; init; } = null!;
    [Inject] private Session Session { get; init; } = null!;

    protected override async Task OnParametersSetAsync() {
        if (Arguments is not [ var sEntryId, var link ])
            throw new ArgumentOutOfRangeException(nameof(Arguments));

        var entryId = new TextEntryId(sEntryId);
        var entry = await Chats.Get(Session, entryId, CancellationToken.None);
        _chatMessageModel = entry != null ? new ChatMessageModel(entry) : null;
        _link = link.NullIfEmpty();
    }
}
