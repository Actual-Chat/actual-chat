@namespace ActualChat.Chat.UI.Blazor.Components
@inherits MenuBase

@if (_chatMessageModel != null) {
    <MessageHoverMenuContent Message="@_chatMessageModel"/>
}

@code {
    private ChatMessageModel? _chatMessageModel;

    [Inject] private IChats Chats { get; init; } = null!;
    [Inject] private Session Session { get; init; } = null!;

    protected override async Task OnParametersSetAsync() {
        if (Arguments is { Length: 2 }) {
            var chatId = new ChatId(Arguments[0]);
            var entryId = long.Parse(Arguments[1]);
            var reader = Chats.NewEntryReader(Session, chatId, ChatEntryKind.Text);
            var chatEntry = await reader.Get(entryId, CancellationToken.None);
            _chatMessageModel = chatEntry != null
                ? new ChatMessageModel(chatEntry)
                : null;
        }
    }
}
