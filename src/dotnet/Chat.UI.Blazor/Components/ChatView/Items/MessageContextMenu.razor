@namespace ActualChat.Chat.UI.Blazor.Components
@using ActualChat.UI.Blazor.Components
@inject FeedbackUI FeedbackUI;
@inject ChatUI ChatUI;

<MenuItem Title="Reaction" Name="wip" OnItemClick="@(() => FeedbackUI.AskFeatureRequestFeedback("message-menu/reaction", "Reactions"))">
    <Icon>
        <svg class="w-5 h-5 fill-current" xlmns="http://www.w3.org/2000/svg" viewBox="-4 -2 28 28">
            <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm3.5 8c.828 0 1.5.671 1.5 1.5s-.672 1.5-1.5 1.5-1.5-.671-1.5-1.5.672-1.5 1.5-1.5zm-7 0c.828 0 1.5.671 1.5 1.5s-.672 1.5-1.5 1.5-1.5-.671-1.5-1.5.672-1.5 1.5-1.5zm3.501 10c-2.801 0-4.874-1.846-6.001-3.566l.493-.493c1.512 1.195 3.174 1.931 5.508 1.931 2.333 0 3.994-.736 5.506-1.931l.493.493c-1.127 1.72-3.199 3.566-5.999 3.566z"/>
        </svg>
    </Icon>
</MenuItem>
<MenuItem Title="Reply" Name="wip" OnItemClick="@(() => FeedbackUI.AskFeatureRequestFeedback("message-menu/reply", "Reply"))">
    <Icon>
        <svg class="w-5 h-5 fill-current -scale-x-100" xlmns="http://www.w3.org/2000/svg" viewBox="0 -2 24 24">
            <path d="M14 18l10-7.088-10-6.912v3.042s-11.618 2.583-14 12.958c5.072-5.431 14-5.218 14-5.218v3.218z"/>
        </svg>
    </Icon>
</MenuItem>
@if (_isJoined && _isEntryAuthor) {
    <MenuItem Title="Edit" Name="wip" OnItemClick="@(() => FeedbackUI.AskFeatureRequestFeedback("message-menu/edit", "Edit Message"))">
        <Icon>
            <svg class="w-5 h-5 fill-current" xlmns="http://www.w3.org/2000/svg" viewBox="-3 -5 30 30">
                <path d="M7.127 22.564l-7.126 1.436 1.438-7.125 5.688 5.689zm-4.274-7.104l5.688 5.689 15.46-15.46-5.689-5.689-15.459 15.46z"/>
            </svg>
        </Icon>
    </MenuItem>
}
@if (_isJoined && _isEntryAuthor) {
    <MenuItem Title="Delete Message" Name="delete message" OnItemClick="@(() => ChatUI.ShowDeleteMessageRequest(Model, RequestAuthor))">
        <Icon>
            <svg class="w-5 h-5 fill-current" xlmns="http://www.w3.org/2000/svg" viewBox="-3 -6 32 32">
                <path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"/>
            </svg>
        </Icon>
    </MenuItem>
}
<MenuItem Title="Create Thread" Name="wip" OnItemClick="@(() => FeedbackUI.AskFeatureRequestFeedback("message-submenu/create-thread", "Create Thread"))">
    <Icon>
        <svg class="w-5 h-5 fill-current" viewBox="-4 -4 32 32" xmlns="http://www.w3.org/2000/svg">
            <path d="M22.548 9l.452-2h-5.364l1.364-6h-2l-1.364 6h-5l1.364-6h-2l-1.364 6h-6.184l-.452 2h6.182l-1.364 6h-5.36l-.458 2h5.364l-1.364 6h2l1.364-6h5l-1.364 6h2l1.364-6h6.185l.451-2h-6.182l1.364-6h5.366zm-8.73 6h-5l1.364-6h5l-1.364 6z"/>
        </svg>
    </Icon>
</MenuItem>
<MenuItem Title="Copy Link" Name="wip" OnItemClick="@(() => FeedbackUI.AskFeatureRequestFeedback("message-submenu/copy-link", "Copy Link"))">
    <Icon>
        <svg class="w-5 h-5 fill-current" viewBox="-4 -4 32 32" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z"/>
        </svg>
    </Icon>
</MenuItem>
<MenuItem Title="Mark Message" Name="wip" OnItemClick="@(() => FeedbackUI.AskFeatureRequestFeedback("message-submenu/mark-message", "Mark Message"))">
    <Icon>
        <svg class="w-5 h-5 fill-current" viewBox="-2 -2 28 28" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 17h2v5l-2 2v-7zm3.571-12c0-2.903 2.36-3.089 2.429-5h-10c.068 1.911 2.429 2.097 2.429 5 0 3.771-3.429 3.291-3.429 10h12c0-6.709-3.429-6.229-3.429-10z"/>
        </svg>
    </Icon>
</MenuItem>

@code{
    [Inject] private IChatAuthors ChatAuthors { get; set; } = null!;
    [Inject] private Session Session { get; set; } = null!;

    [CascadingParameter] public ChatMessageModel Model { get; set; } = null!;
    private ChatAuthor RequestAuthor { get; set; } = null!;

    private bool _isJoined;
    private bool _isEntryAuthor;

    protected override async Task OnInitializedAsync() {
        await base.OnInitializedAsync();
        await InitRequestAuthorId();
    }

    private async Task InitRequestAuthorId() {
        var requestAuthor = await ChatAuthors.GetChatAuthor(Session, Model.Entry.ChatId, CancellationToken.None).ConfigureAwait(true);
        if (requestAuthor == null)
            return;
        RequestAuthor = requestAuthor;
        _isEntryAuthor = RequestAuthor.Id == Model.Entry.AuthorId;
        _isJoined = true;
    }
}
