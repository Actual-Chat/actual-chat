@namespace ActualChat.Chat.UI.Blazor.Components
@{
    if (!_areReactionsEnabled)
        return;
}
<ul class="reaction-select">
    @foreach (var emoji in Emoji.All) {
        <MenuEntry
            OnClick="_ => React(emoji.Code)"
            Class="reaction-select-reaction"
            Tooltip="@emoji.Name">
            <TextContent>@emoji.Code</TextContent>
        </MenuEntry>
    }
</ul>

@code {
    private bool _areReactionsEnabled;

    [Inject] private Session Session { get; init; } = null!;
    [Inject] private UICommander UICommander { get; init; } = null!;
    [Inject] private Features Features { get; init; } = null!;
    [Parameter, EditorRequired] public ChatEntry ChatEntry { get; set; } = null!;

    protected override async Task OnInitializedAsync() {
        _areReactionsEnabled = await Features.Get<UIFeatures.EnableMessageReactions, bool>(CancellationToken.None);
    }

    private Task React(string emoji) {
        var command = new IReactions.ReactCommand(Session, new Reaction {
            ChatId = ChatEntry.ChatId, EntryId = ChatEntry.Id, Emoji = emoji,
        });
        return UICommander.Run(command);
    }
}
