@namespace ActualChat.Chat.UI.Blazor.Components

@if (!Contact.IsFavorite) {
    <MenuEntry
        OnClick="OnClick"
        Icon="icon-heart-fill text-2xl"
        Text="Add to Favorites">
    </MenuEntry>
}

@code {
    [Inject] private Session Session { get; init; } = null!;
    [Inject] private DiffEngine DiffEngine { get; init; } = null!;
    [Inject] private UICommander UICommander { get; init; } = null!;

    [CascadingParameter] public UserContact Contact { get; set; } = null!;

    private async Task OnClick() {
        var diff = DiffEngine.Diff<UserContact, UserContactDiff>(Contact, Contact with { IsFavorite = true });
        var command = new IUserContacts.ChangeCommand(Session, Contact.Id, null, new Change<UserContactDiff> { Update = diff });
        await UICommander.Run(command);
    }
}
