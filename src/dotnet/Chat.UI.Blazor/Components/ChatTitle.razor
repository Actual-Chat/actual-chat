<Dropdown MenuClass="top-10 w-max md:w-min left-4" Class="static align-middle" ButtonClass="btn-transparent">
    <ButtonTemplate>
        <div class="inline-flex">
            <span class="float-left text-secondary font-semibold chat-header-title">@Chat.Title</span>
        </div>
    </ButtonTemplate>
    <MenuTemplate>
        <Menu Class="rounded-md border border-accent p-1" ItemClass="text-left" Orientation="Orientation.Vertical" IconPosition="IconPosition.Right">
            <MenuItem Title="Edit your name, image and bio in this chat" OnItemClick="OnEditChatAuthorAvatar" Class="truncate"></MenuItem>
        </Menu>
    </MenuTemplate>
</Dropdown>

@code {
    private bool _canEdit;
    private bool _canInvite;

    [Inject] private Session Session { get; init; } = null!;
    [Inject] private IChats Chats { get; init; } = null!;
    [Inject] private NavigationManager Nav { get; init; } = null!;

    [CascadingParameter] public Chat Chat { get; set; } = null!;

    protected override async Task OnParametersSetAsync() {
        await base.OnParametersSetAsync();
        var permissions = await Chats.GetPermissions(Session, Chat.Id, default);
        _canEdit = permissions.HasFlag(ChatPermissions.Admin);
        _canInvite = permissions.HasFlag(ChatPermissions.Invite);
    }

    private void OnEditChatAuthorAvatar()
        => Nav.NavigateTo($"/chat/{Chat.Id}/edit/avatar");
}
