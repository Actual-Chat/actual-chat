@namespace ActualChat.Chat.UI.Blazor.Components

@{
    var author = Model.Author;
    var entry = Model.Entry;
    var picture = string.IsNullOrWhiteSpace(author.Picture)
        ? $"https://avatars.dicebear.com/api/avataaars/{author.Name}.svg"
        : author.Picture;
}

<div class="chat-message flex items-start mb-4 text-sm">
    <img src="@picture" class="author w-10 h-10 rounded-md mr-3 select-none bg-gray-50" alt="@author.Name"/>
    <div class="flex-1 overflow-hidden">
        <div class="header">
            <span class="font-bold text-gray-900">@author.Name</span>
            <span class="text-gray-500 text-xs">@entry.BeginsAt.ToString("HH:mm")</span>
            &nbsp;
            <span class="text-gray-100 text-xs">id=@entry.Id</span>
        </div>
        <div class="content">
            @if (entry.IsStreaming) {
                <ChatMessageTranscript Model="@Model"/>
            } else {
                <ChatMessageMarkup Model="@Model"/>
            }
        </div>
    </div>
</div>

@code {
    [Parameter, EditorRequired, ParameterComparer(typeof(ByReferenceParameterComparer))]
    public ChatMessageModel Model { get; set; } = null!;

    public override Task SetParametersAsync(ParameterView parameters)
        => this.HasChangedParameters(parameters) ? base.SetParametersAsync(parameters) : Task.CompletedTask;
}
