@inherits ComputedStateComponent<AccountFull>
@{
    var account = State.Value;
    if (ReferenceEquals(account, AccountFull.Loading))
        return;

    var avatar = account.Avatar;
}

<Tile>
    <TileItem IsHoverable="false" Class="first-tile-item">
        <Icon>
            <AccountBadge
                UserSid="@account.Id"
                Size="SquareSize.Size9"
                ShowPresence="false"
                NameClass="hidden" />
        </Icon>
        <Right>
            <TileButtons EditClick="@OnEditClick"/>
        </Right>
        <Content>
            @account.FullName
        </Content>
        <Caption>
            Name
        </Caption>
    </TileItem>

    <TileItem>
        <Icon>
            <i class="icon-at text-xl"></i>
        </Icon>
        <Content>
            @account.Email
        </Content>
        <Caption>
            Email
        </Caption>
        <Right>
            <CopyToClipboard ButtonClass="btn-sm transparent tile-hidden-btn" Text="@account.Email"/>
        </Right>
    </TileItem>

    <TileItem>
        <Icon>
            <i class="icon-phone text-xl"></i>
        </Icon>
        <Right>
            <CopyToClipboard ButtonClass="btn-sm transparent tile-hidden-btn" Text="@account.Phone"/>
        </Right>
        <Content>
            @account.Phone
        </Content>
        <Caption>
            Phone
        </Caption>
    </TileItem>

    <TileItem>
        <Icon>
            <i class="icon-info text-xl"></i>
        </Icon>
        <Content>
            @avatar.Bio
        </Content>
        <Caption>
            Bio
        </Caption>
    </TileItem>

    <LinkTileItem Link="@Links.User(account.Id)"
                  Caption="Link to your account"
                  data-bubble="@(BubbleRef.New<LinkToAccountBubble>())"
                  data-bubble-priority="301"
                  data-bubble-placement="@(FloatingPosition.RightStart.ToPositionString())">
    </LinkTileItem>
</Tile>

<TileTopic Topic="My avatars"/>

<OwnAvatarList Account="@account"/>

@code {
    [Inject] private Session Session { get; init; } = null!;
    [Inject] private IAccounts Accounts { get; init; } = null!;
    [Inject] private IAvatars Avatars { get; init; } = null!;
    [Inject] private ModalUI ModalUI { get; init; } = null!;
    [Inject] private BubbleUI BubbleUI { get; init; } = null!;
    [Inject] private UrlMapper UrlMapper { get; init; } = null!;

    protected override ComputedState<AccountFull>.Options GetStateOptions()
        => new() {
            InitialValue = AccountFull.Loading,
            Category = GetStateCategory(),
        };

    protected override Task<AccountFull> ComputeState(CancellationToken cancellationToken)
        => Accounts.GetOwn(Session, cancellationToken);

    private Task OnEditClick()
        => ModalUI.Show(OwnAccountEditorModal.Model.Default);
}
