@namespace ActualChat.Chat.UI.Blazor.Components
@inherits ComputedStateComponent<ChatAuthorRules>
@{
    var m = State.LatestNonErrorValue;
}

<div class="flex-y text-secondary">
    @if (m.CanEditProperties) {
        <ChatBasicSettings/>
    }
    @if (m.CanInvite) {
        <ChatInviteSettings/>
    }
</div>

@code {
    [Inject] private Session Session { get; init; } = null!;
    [Inject] private IChats Chats { get; init; } = null!;

    [CascadingParameter] public Chat Chat { get; set; } = null!;

    protected override ComputedState<ChatAuthorRules>.Options GetStateOptions()
        => new() {
            InitialValue = ChatAuthorRules.None(Chat.Id),
            UpdateDelayer = UpdateDelayer.MinDelay,
        };

    protected override Task<ChatAuthorRules> ComputeState(CancellationToken cancellationToken)
        => Chats.GetRules(Session, Chat.Id, default);
}
