@namespace ActualChat.Chat.UI.Blazor.Components
@using ActualChat.Notification
@using ActualChat.Users.UI.Blazor.Services
@inherits ComputedStateComponent<ChatSettingsToggle.Model>
@{
    var isRightPanelShown = State.Value.IsRightPanelShown;
}

<ButtonSquare OnClick="OnClick"
              Class="@(isRightPanelShown ? "on" : "off")"
              Title="@(isRightPanelShown ? "Hide settings" : "Show settings")">
    <i class="fa fa-cogs fa-sidebar-flip fa-lg w-8 h-8 pt-2" aria-hidden="true"></i>
</ButtonSquare>

@code {
    [Inject] private UserSettings UserSettings { get; init; } = null!;

    protected override ComputedState<Model>.Options GetStateOptions()
        => new() { InitialValue = Model.None };

    protected override async Task<Model> ComputeState(CancellationToken cancellationToken) {
        var isRightPanelShown = await UserSettings.IsRightPanelShown.Use(cancellationToken);
        return new() {
            IsRightPanelShown = isRightPanelShown,
        };
    }

    private void OnClick()
        => UserSettings.IsRightPanelShown.Value = !State.Value.IsRightPanelShown;

    public class Model {
        public static Model None { get; } = new();
        public bool IsRightPanelShown { get; init; }
    }
}
