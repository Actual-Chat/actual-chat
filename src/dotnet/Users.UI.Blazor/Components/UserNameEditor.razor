@using System.ComponentModel.DataAnnotations
@{
    var m = _model;
}
<Form Model="@m" OnValidSubmit="@OnSave" >
    <DataAnnotationsValidator />
    <ValidationSummary />

    <FormSection InputId="@m.NameId" Label="User name" IsRequired="true">
        <TextBox @bind-Value="@m.Name" id="@m.NameId" Autofocus="true" />
    </FormSection>

    <FormButtons>
        <Button Type="@ButtonType.Submit" class="btn-success">Save</Button>
    </FormButtons>
</Form>

@code {
    private Model _model = null!;

    [Inject] private Session Session { get; init; } = null!;
    [Inject] private IUserAuthors UserAuthors { get; init; } = null!;
    [Inject] private UICommandRunner Cmd { get; init; } = null!;
    [Inject] private ComponentIdGenerator ComponentIdGenerator { get; init; } = null!;

    protected override async Task OnParametersSetAsync() {
        _model ??= new Model(ComponentIdGenerator);
        _model.Name = await UserAuthors.GetName(Session, default).ConfigureAwait(true);
    }

    private async void OnSave() {
        var command = new IUserAuthors.UpdateNameCommand(Session, _model.Name);
        await Cmd.Run(command).ConfigureAwait(true);
    }

    public sealed class Model {
        public string FormId { get; }
        public string NameId { get; }

        [Required, MinLength(4)]
        public string Name { get; set; } = "";

        public Model(ComponentIdGenerator componentIdGenerator) {
            FormId = componentIdGenerator.Next("user-name-editor");
            NameId = $"{FormId}-name";
        }
    }
}
