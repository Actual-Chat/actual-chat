@using Microsoft.Toolkit.HighPerformance
@namespace ActualChat.UI.Blazor.Components.ChatIcon

@if (Picture.IsNullOrEmpty()) {
    <div class="chat-icon chat-icon-generated @_iconClass"
         style="@_iconStyle">
        @Title[..1]
    </div>
} else {
    <img class="chat-icon chat-icon-image @_iconClass"
         alt=""
         src="@Picture" />
}

@code {
    private string _iconClass = "";
    private string _iconStyle = "";

    [Parameter] public string Title { get; set; } = "";
    [Parameter] public string Picture { get; set; } = "";
    [Parameter] public SquareSize Size { get; set; } = SquareSize.Size9;
    [Parameter] public EventCallback<MouseEventArgs> Click { get; set; }

    protected override void OnParametersSet() {
        _iconClass = Size.GetCssClass();

        if (Click.HasDelegate)
            _iconClass += " cursor-pointer";

        if (Picture.IsNullOrEmpty())
            _iconStyle = $"background-color: {GenerateColor()}";
    }

    private string GenerateColor() {
        var hash = Title.GetDjb2HashCode();
        var h = hash % 360;
        return $"hsl({h}, 30%, 80%)";
    }
}
