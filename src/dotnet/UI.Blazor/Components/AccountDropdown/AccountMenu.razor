@namespace ActualChat.UI.Blazor.Components
@using ActualChat.Users
@using ActualChat.UI.Blazor.Services

<Dropdown Class="flex items-center justify-end" ButtonClass="account-btn btn-square">
    <ButtonTemplate>
        <AccountView/>
    </ButtonTemplate>
    <MenuTemplate>
        <Menu Class="account-dropdown-menu" ItemClass="text-left" Orientation="MenuOrientation.Vertical" IconPosition="MenuIconPosition.Right">
            <MenuItem Title="Settings" Name="settings" Click="OnSettingsClick">
                <Icon>
                    <svg class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="-4 -2 32 32">
                        <path d="M24 13.616v-3.232l-2.869-1.02c-.198-.687-.472-1.342-.811-1.955l1.308-2.751-2.285-2.285-2.751 1.307c-.613-.339-1.269-.613-1.955-.811l-1.021-2.869h-3.232l-1.021 2.869c-.686.198-1.342.471-1.955.811l-2.751-1.308-2.285 2.285 1.308 2.752c-.339.613-.614 1.268-.811 1.955l-2.869 1.02v3.232l2.869 1.02c.197.687.472 1.342.811 1.955l-1.308 2.751 2.285 2.286 2.751-1.308c.613.339 1.269.613 1.955.811l1.021 2.869h3.232l1.021-2.869c.687-.198 1.342-.472 1.955-.811l2.751 1.308 2.285-2.286-1.308-2.751c.339-.613.613-1.268.811-1.955l2.869-1.02zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/>
                    </svg>
                </Icon>
            </MenuItem>
            <MenuItem Title="Sign Out" Name="singOut" Click="OnSignOutClick">
                <Icon>
                    <svg xmlns="http://www.w3.org/2000/svg" class="fill-current h-6 w-6" viewBox="-6 -2 32 32">
                        <path d="M16 9v-4l8 7-8 7v-4h-8v-6h8zm-16-7v20h14v-2h-12v-16h12v-2h-14z"/>
                    </svg>
                </Icon>
            </MenuItem>
        </Menu>
    </MenuTemplate>
</Dropdown>

@code {
    [Inject] private Session Session { get; init; } = null!;
    [Inject] private IUserProfiles UserProfiles { get; init; } = null!;
    [Inject] private ClientAuthHelper ClientAuthHelper { get; init; } = null!;
    [Inject] private FeedbackUI FeedbackUI { get; init; } = null!;
    [Inject] private NavigationManager Nav { get; init; } = null!;

    private bool IsOpen { get; set; }

    private void OnSettingsClick() {
        Nav.NavigateTo("/settings");
    }

    private async Task OnSignOutClick() {
        IsOpen = false;
        await ClientAuthHelper.SignOut();
    }
}
