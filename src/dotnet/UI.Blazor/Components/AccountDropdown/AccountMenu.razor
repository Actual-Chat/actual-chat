@namespace ActualChat.UI.Blazor.Components
@using ActualChat.Users
@using ActualChat.UI.Blazor.Services

<Dropdown Class="relative mt-1" MenuClass="bottom-12 w-48 rounded-md" ButtonClass="!border-0 !pl-0.5 !bg-primary">
    <ButtonTemplate>
        <AccountView/>
    </ButtonTemplate>
    <MenuTemplate>
        <Menu Class="rounded-md border border-accent" ItemClass="text-left" Orientation="MenuOrientation.Vertical" IconPosition="MenuIconPosition.Right">
            <MenuItem Title="User info" Name="userInfo" Click="OnUserInfoClick">
                <Icon>
                    <svg class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="-4 -2 32 32">
                        <path d="M24 22h-24v-20h24v20zm-1-19h-22v18h22v-18zm-4 13v1h-4v-1h4zm-6.002 1h-10.997l-.001-.914c-.004-1.05-.007-2.136 1.711-2.533.789-.182 1.753-.404 1.892-.709.048-.108-.04-.301-.098-.407-1.103-2.036-1.305-3.838-.567-5.078.514-.863 1.448-1.359 2.562-1.359 1.105 0 2.033.488 2.545 1.339.737 1.224.542 3.033-.548 5.095-.057.106-.144.301-.095.41.14.305 1.118.531 1.83.696 1.779.41 1.773 1.503 1.767 2.56l-.001.9zm-9.998-1h8.999c.003-1.014-.055-1.27-.936-1.473-1.171-.27-2.226-.514-2.57-1.267-.174-.381-.134-.816.119-1.294.921-1.739 1.125-3.199.576-4.111-.332-.551-.931-.855-1.688-.855-.764 0-1.369.31-1.703.871-.542.91-.328 2.401.587 4.09.259.476.303.912.13 1.295-.342.757-1.387.997-2.493 1.252-.966.222-1.022.478-1.021 1.492zm18-3v1h-6v-1h6zm0-3v1h-6v-1h6zm0-3v1h-6v-1h6z"/>
                    </svg>
                </Icon>
            </MenuItem>
            <MenuItem Title="Settings" Name="settings" Click="OnSettingsClick">
                <Icon>
                    <svg class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="-4 -2 32 32">
                        <path d="M24 13.616v-3.232l-2.869-1.02c-.198-.687-.472-1.342-.811-1.955l1.308-2.751-2.285-2.285-2.751 1.307c-.613-.339-1.269-.613-1.955-.811l-1.021-2.869h-3.232l-1.021 2.869c-.686.198-1.342.471-1.955.811l-2.751-1.308-2.285 2.285 1.308 2.752c-.339.613-.614 1.268-.811 1.955l-2.869 1.02v3.232l2.869 1.02c.197.687.472 1.342.811 1.955l-1.308 2.751 2.285 2.286 2.751-1.308c.613.339 1.269.613 1.955.811l1.021 2.869h3.232l1.021-2.869c.687-.198 1.342-.472 1.955-.811l2.751 1.308 2.285-2.286-1.308-2.751c.339-.613.613-1.268.811-1.955l2.869-1.02zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/>
                    </svg>
                </Icon>
            </MenuItem>
            <MenuItem Title="Sign Out" Name="singOut" Click="OnSignOutClick">
                <Icon>
                    <svg xmlns="http://www.w3.org/2000/svg" class="fill-current h-6 w-6" viewBox="-6 -2 32 32">
                        <path d="M16 9v-4l8 7-8 7v-4h-8v-6h8zm-16-7v20h14v-2h-12v-16h12v-2h-14z"/>
                    </svg>
                </Icon>
            </MenuItem>
        </Menu>
    </MenuTemplate>
</Dropdown>

@code {
    [Inject] private Session Session { get; init; } = null!;
    [Inject] private IUserProfiles UserProfiles { get; init; } = null!;
    [Inject] private ClientAuthHelper ClientAuthHelper { get; init; } = null!;
    [Inject] private FeedbackUI FeedbackUI { get; init; } = null!;
    [Inject] private NavigationManager Nav { get; init; } = null!;

    private bool IsOpen { get; set; }

    private void OnSettingsClick() {
        Nav.NavigateTo("/settings");
    }

    private async Task OnSignOutClick() {
        IsOpen = false;
        await ClientAuthHelper.SignOut();
    }

    private async Task OnUserInfoClick() {
        var userProfile = await UserProfiles.Get(Session, default).ConfigureAwait(false);
        var userId = userProfile!.User.Id;
        Nav.NavigateTo("/u/" + userId);
    }

}
