@namespace ActualChat.UI.Blazor.Components
@using ActualChat.Users

<div class="author-badge flex-x items-center">
    <AuthorCircle Author="@Author" Size="@Size" Presence="@Presence" Click="@Click"/>
    <div class="flex-y @_contentClass">
        <div>
            <span class="@_nameClass">@Author.Name</span>
        </div>
        @if (ShowsStatusText && !_statusText.IsNullOrEmpty()) {
            <div>
                <span class="@_statusTextClass">@_statusText</span>
            </div>
        }
    </div>
</div>

@code {
    private string _contentClass = "";
    private string _nameClass = "";
    private string _statusTextClass = "";
    private string _statusText = "";

    [Parameter] public SquareSize Size { get; set; } = SquareSize.Size9;
    [Parameter] public Presence Presence { get; set; } = Presence.Unknown;
    [Parameter] public string TextClass { get; set; } = "";
    [Parameter] public IAuthorLike Author { get; set; } = null!;
    [Parameter] public bool ShowsStatusText { get; set; }
    [Parameter] public EventCallback<MouseEventArgs> Click { get; set; }

    protected override void OnParametersSet() {
        base.OnParametersSet();
        _nameClass = GetNameClass();
        _contentClass = GetContentClass();
        _statusText = GetStatusText();
        _statusTextClass = GetStatusTextClass();
    }

    private string GetStatusText()
        => Presence switch {
            Presence.Recording => "recording",
            Presence.Online => "online",
            _ => "",
        };

    private string GetStatusTextClass()
        => Size switch {
            SquareSize.Size12 => "",
            _ => "text-xxs leading-4",
        };

    private string GetNameClass() {
        if (!TextClass.IsNullOrEmpty())
            return TextClass;

        var sizeClass = Size switch {
            SquareSize.Size6 => "",
            SquareSize.Size8 => "",
            _ => "text-md",
            };
        return "select-none " + sizeClass;
    }

    private string GetContentClass()
        => "ml-3";
}
