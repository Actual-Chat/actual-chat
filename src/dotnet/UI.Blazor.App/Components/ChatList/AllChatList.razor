@namespace ActualChat.UI.Blazor.App.Components
@inherits FusionComponentBase
@{
    DebugLog?.LogDebug("Rendered: {List}", ChatListKind.All);
}

@* ChatListKind.All *@
<VirtualList
    @ref="_virtualListRef"
    Class="chat-list chat-list-all"
    DataSource="@this"
    ExpandTriggerMultiplier="0.5"
    ExpandMultiplier="0.7"
    SkeletonCount="50"
    ItemVisibilityChanged="@OnItemVisibilityChanged"
>
    <Item>
        <ChatListItem
            ListKind="@ChatListKind.All"
            Chat="@context.Chat"
            IsLastItemInBlock="@context.IsLastItemInBlock"
            IsFirstItem="@context.IsFirstItem"/>
    </Item>
    <Skeleton>
        <ChatListItemSkeleton />
    </Skeleton>
</VirtualList>

@code {
    private VirtualList<ChatListItemModel>? _virtualListRef = null;
    private ILogger? _log;

    [Inject] private ChatUIHub Hub { get; set; } = null!;
    private ChatUI ChatUI => Hub.ChatUI;
    private ChatListUI ChatListUI => Hub.ChatListUI;
    private ILogger Log => _log ??= Hub.LogFor(GetType());
    private ILogger? DebugLog => Constants.DebugMode.ChatListComponents ? Log : null;

    [Parameter, EditorRequired] public PlaceId PlaceId { get; set; }

    protected override void OnInitialized()
        => DebugLog?.LogDebug("OnInitialized: {List}", ChatListKind.All);

    protected override void OnParametersSet() {
        DebugLog?.LogDebug("OnParametersSet: {List}", ChatListKind.All);
        _ = _virtualListRef?.Reset();
    }
}
